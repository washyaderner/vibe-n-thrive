---
const services = [
  {
    id: 'tissue-muscle-repair',
    icon: '~',
    title: 'Tissue & Muscle Repair',
    short: 'Deep vibrational therapy that accelerates tissue healing and promotes muscle recovery.',
    description: 'This session uses targeted low-frequency vibrations to penetrate deep into muscle fibers and connective tissue, stimulating cellular repair at the source. The therapeutic sound waves increase blood flow to damaged areas, reduce inflammation, and help break down scar tissue. Whether you\'re recovering from surgery, managing a soft-tissue injury, or dealing with chronic muscle tension, this protocol supports your body\'s natural healing process and gets you back to feeling whole.',
    duration: '60 min',
  },
  {
    id: 'targeted-relief',
    icon: '+',
    title: 'Targeted Pain Relief',
    short: 'Focused vibration therapy for specific areas of pain, tension, or injury.',
    description: 'This precision session concentrates therapeutic vibrations on your areas of greatest need — whether that\'s lower back pain, neck tension, joint stiffness, or injury recovery. Our therapists adjust frequency and amplitude to match your specific condition, delivering relief where you need it most.',
    duration: '60 min',
  },
  {
    id: 'stress-anxiety',
    icon: '*',
    title: 'Stress & Anxiety Relief',
    short: 'Sound-based therapy designed to calm the nervous system and promote mental clarity.',
    description: 'Combining low-frequency vibrations with carefully selected soundscapes, this session is specifically designed to activate your parasympathetic nervous system. Research shows that VAT can significantly reduce cortisol levels, lower heart rate, and improve sleep quality. Perfect for anxiety, insomnia, and burnout recovery.',
    duration: '60 min',
  },
  {
    id: 'recovery-mobility',
    icon: '^',
    title: 'Recovery & Mobility',
    short: 'Enhance athletic recovery and improve range of motion through vibrational therapy.',
    description: 'Athletes and active individuals use this session to accelerate recovery between workouts, reduce muscle soreness (DOMS), and improve flexibility. The therapeutic vibrations increase blood flow to fatigued muscles, break up fascial adhesions, and help restore full range of motion faster than passive recovery alone.',
    duration: '60 min',
  },
  {
    id: 'chakra-alignment',
    icon: '\u2726',
    title: 'Chakra Alignment',
    short: 'Vibrational tuning designed to balance and align your body\'s seven energy centers.',
    description: 'Each chakra resonates at a specific frequency. This session uses precisely tuned vibrations matched to the natural frequency of each energy center — from the grounding tones of the root chakra to the elevated frequencies of the crown. As the vibrations move through your body, blockages are gently released and energy flow is restored, bringing your physical, emotional, and spiritual bodies back into harmony.',
    duration: '60 min',
  },
  {
    id: 'cognitive-enhancement',
    icon: '\u2662',
    title: 'Focus & Cognitive Enhancement',
    short: 'Frequency therapy designed to sharpen focus, boost memory, and elevate productivity.',
    description: 'Specific vibrational frequencies can influence brainwave activity, guiding your mind into states associated with heightened focus, creativity, and memory consolidation. This session uses carefully calibrated low-frequency patterns to encourage alpha and theta brainwave states — the same states linked to deep learning and peak mental performance. Ideal for professionals, students, or anyone looking to clear brain fog, improve recall, and sustain productive flow.',
    duration: '60 min',
  },
];
---

<section class="services section" id="services">
  <div class="container">
    <div class="text-center">
      <p class="section-label">What We Offer</p>
      <h2 class="section-title">Our Therapies</h2>
      <p class="section-subtitle" style="margin-left:auto;margin-right:auto;">
        Each session is tailored to your body's needs. Click any service to learn more.
      </p>
    </div>

    <div class="services__grid" id="services-grid">
      {services.map((service, i) => (
        <button
          class="services__card glass"
          data-index={i}
          style={`--delay: ${i * 0.1}s`}
        >
          <span class="services__icon">{service.icon}</span>
          <h3 class="services__title">{service.title}</h3>
          <p class="services__desc">{service.short}</p>
          <span class="services__duration">{service.duration}</span>
        </button>
      ))}
    </div>

    <div class="services__detail" id="services-detail">
      <div class="services__detail-inner" id="services-detail-inner">
        <button class="services__detail-close" id="services-detail-close" aria-label="Close detail">&times;</button>
        {services.map((service, i) => (
          <div class="services__detail-panel" data-detail={i} id={service.id}>
            <h3 class="services__detail-title">{service.title}</h3>
            <span class="services__detail-duration">{service.duration} session</span>
            <p class="services__detail-text">{service.description}</p>
          </div>
        ))}
      </div>
    </div>
  </div>
</section>

<style>
  /* --- Grid --- */
  .services__grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1.5rem;
  }

  /* --- Card base --- */
  .services__card {
    display: block;
    padding: 2rem;
    text-align: left;
    text-decoration: none;
    color: inherit;
    font-family: inherit;
    font-size: inherit;
    border: none;
    cursor: pointer;
    transition: all 0.4s var(--ease-out);
    /* Scroll-in animation: start hidden */
    opacity: 0;
    transform: translateY(30px);
  }

  .services__card.is-visible {
    opacity: 1;
    transform: translateY(0);
    transition: opacity 0.6s var(--ease-out) var(--delay),
                transform 0.6s var(--ease-out) var(--delay),
                box-shadow 0.4s var(--ease-out),
                border-color 0.4s var(--ease-out);
  }

  .services__card:hover {
    transform: translateY(-6px);
    box-shadow:
      0 12px 40px rgba(0, 0, 0, 0.08),
      0 0 0 2px rgba(13, 148, 136, 0.15);
    color: inherit;
  }

  .services__card.is-active {
    border-color: var(--color-teal);
    box-shadow:
      0 0 0 2px var(--color-teal),
      0 8px 30px rgba(13, 148, 136, 0.18);
  }

  /* --- Icon with pulse --- */
  .services__icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 48px;
    height: 48px;
    border-radius: 14px;
    background: linear-gradient(135deg, var(--color-teal-light), var(--color-teal));
    color: var(--color-white);
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 1.25rem;
    transition: transform 0.4s var(--ease-out);
  }

  .services__card:hover .services__icon {
    transform: scale(1.1);
    animation: icon-pulse 1.5s ease-in-out infinite;
  }

  @keyframes icon-pulse {
    0%, 100% { transform: scale(1.1); }
    50% { transform: scale(1.18); }
  }

  .services__title {
    font-size: 1.125rem;
    margin-bottom: 0.75rem;
  }

  .services__desc {
    font-size: 0.9375rem;
    color: var(--color-gray-600);
    line-height: 1.6;
    margin-bottom: 1rem;
  }

  .services__duration {
    display: inline-block;
    font-size: 0.8125rem;
    font-weight: 600;
    color: var(--color-teal);
    background: rgba(13, 148, 136, 0.08);
    padding: 0.25rem 0.75rem;
    border-radius: 100px;
  }

  /* --- Inline detail panel --- */
  .services__detail {
    display: grid;
    grid-template-rows: 0fr;
    transition: grid-template-rows 0.5s var(--ease-out);
    margin-top: 0;
  }

  .services__detail.is-open {
    grid-template-rows: 1fr;
    margin-top: 2rem;
  }

  .services__detail-inner {
    overflow: hidden;
    position: relative;
  }

  .services__detail.is-open .services__detail-inner {
    padding: 2.5rem;
    background: rgba(255, 255, 255, 0.55);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.6);
    border-radius: 24px;
  }

  .services__detail-close {
    position: absolute;
    top: 1rem;
    right: 1.25rem;
    background: none;
    border: none;
    font-size: 1.75rem;
    color: var(--color-gray-400);
    cursor: pointer;
    line-height: 1;
    padding: 0.25rem;
    transition: color var(--transition-base);
    z-index: 1;
    display: none;
  }

  .services__detail.is-open .services__detail-close {
    display: block;
  }

  .services__detail-close:hover {
    color: var(--color-gray-800);
  }

  .services__detail-panel {
    display: none;
    animation: detail-fade-in 0.4s var(--ease-out);
  }

  .services__detail-panel.is-active {
    display: block;
  }

  @keyframes detail-fade-in {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .services__detail-title {
    font-size: 1.375rem;
    margin-bottom: 0.5rem;
  }

  .services__detail-duration {
    display: inline-block;
    font-size: 0.8125rem;
    font-weight: 600;
    color: var(--color-teal);
    margin-bottom: 1rem;
  }

  .services__detail-text {
    font-size: 1rem;
    color: var(--color-gray-600);
    line-height: 1.8;
    max-width: 65ch;
  }

  @media (max-width: 900px) {
    .services__grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (max-width: 768px) {
    .services__detail.is-open .services__detail-inner {
      padding: 2rem 1.5rem;
      backdrop-filter: none;
      -webkit-backdrop-filter: none;
      background: rgba(255, 255, 255, 0.92);
    }
  }

  @media (max-width: 560px) {
    .services__grid {
      grid-template-columns: 1fr;
    }
  }
</style>

<script>
  // --- Scroll-triggered staggered entrance ---
  const cards = document.querySelectorAll('.services__card');
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('is-visible');
        observer.unobserve(entry.target);
      }
    });
  }, { threshold: 0.15 });

  cards.forEach(card => observer.observe(card));

  // --- Click to expand detail ---
  const detail = document.getElementById('services-detail');
  const panels = document.querySelectorAll('.services__detail-panel');
  const closeBtn = document.getElementById('services-detail-close');
  let activeIndex: number | null = null;

  function openDetail(index: number) {
    // Update active card
    cards.forEach(c => c.classList.remove('is-active'));
    cards[index]?.classList.add('is-active');

    // Update active panel
    panels.forEach(p => p.classList.remove('is-active'));
    panels[index]?.classList.add('is-active');

    // Open container
    detail?.classList.add('is-open');
    activeIndex = index;

    // Scroll detail into view after animation
    setTimeout(() => {
      detail?.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }, 100);
  }

  function closeDetail() {
    detail?.classList.remove('is-open');
    cards.forEach(c => c.classList.remove('is-active'));
    panels.forEach(p => p.classList.remove('is-active'));
    activeIndex = null;
  }

  cards.forEach((card, i) => {
    card.addEventListener('click', () => {
      if (activeIndex === i) {
        closeDetail();
      } else {
        openDetail(i);
      }
    });
  });

  closeBtn?.addEventListener('click', closeDetail);
</script>
